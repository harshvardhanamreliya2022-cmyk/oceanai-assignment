# Selenium Script Testing Guide

This guide explains how to test the Selenium scripts generated by the QA Agent.

## Prerequisites

### 1. Install Selenium and WebDriver

```bash
# Activate virtual environment
cd /home/user/oceanai-assignment
source venv/bin/activate

# Install Selenium
pip install selenium

# Install WebDriver Manager (auto-downloads browser drivers)
pip install webdriver-manager
```

### 2. Install a Browser

You need one of these browsers installed:
- **Chrome/Chromium** (recommended)
- Firefox
- Edge

For headless testing (no GUI), Chrome/Chromium works best.

## Quick Start Testing

### Option 1: Test with Local HTML File

1. **Generate a Selenium script** using the UI or API
2. **Save the script** to `data/scripts/test_script.py`
3. **Run the test server**:

```bash
# Start a simple HTTP server to serve the test HTML
cd test_data
python3 -m http.server 8080
```

4. **In another terminal, run the script**:

```bash
cd /home/user/oceanai-assignment
source venv/bin/activate
python data/scripts/test_script.py
```

### Option 2: Use the Test Runner Script

We've created a helper script to make testing easier:

```bash
# Run a specific test script
./run_selenium_test.sh data/scripts/TC_001_selenium.py

# Run with verbose output
./run_selenium_test.sh data/scripts/TC_001_selenium.py --verbose

# Run all tests
./run_selenium_test.sh --all
```

## Testing Workflow

### Step 1: Generate Test Cases

Use the Streamlit UI or API to generate test cases for your feature:

```bash
curl -X POST http://localhost:8000/test-cases/generate \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Generate test cases for discount code SAVE15",
    "include_negative": true,
    "max_test_cases": 3
  }'
```

### Step 2: Generate Selenium Script

Use the generated test case and HTML content:

```bash
curl -X POST http://localhost:8000/selenium-scripts/generate \
  -H "Content-Type: application/json" \
  -d '{
    "test_case_id": "TC_001",
    "feature": "Discount Code",
    "test_scenario": "Apply SAVE15 discount code",
    "test_steps": ["Add products", "Enter code", "Click apply"],
    "expected_result": "15% discount applied",
    "grounded_in": "requirements.md",
    "test_type": "positive",
    "html_content": "<html>...</html>",
    "include_assertions": true,
    "include_logging": true
  }'
```

### Step 3: Modify Script for Your Target URL

The generated script uses a placeholder URL. Update it:

```python
# Before:
driver.get("http://localhost:8080/simple_checkout.html")

# After (for production):
driver.get("https://your-app.com/checkout")
```

### Step 4: Run the Script

```bash
python data/scripts/TC_001_selenium.py
```

## Common Issues and Solutions

### Issue 1: WebDriver Not Found

**Error:** `selenium.common.exceptions.WebDriverException: Message: 'chromedriver' executable needs to be in PATH`

**Solution:**
```bash
pip install webdriver-manager
```

Then update your script to use WebDriver Manager:
```python
from selenium import webdriver
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.chrome.service import Service

service = Service(ChromeDriverManager().install())
driver = webdriver.Chrome(service=service)
```

### Issue 2: Element Not Found

**Error:** `selenium.common.exceptions.NoSuchElementException`

**Solution:**
- Check that the HTML selectors match your actual HTML
- Add explicit waits before interacting with elements
- Use the browser DevTools to verify selector syntax

### Issue 3: Headless Mode for CI/CD

To run tests in headless mode (no GUI):

```python
from selenium.webdriver.chrome.options import Options

options = Options()
options.add_argument('--headless')
options.add_argument('--no-sandbox')
options.add_argument('--disable-dev-shm-usage')

driver = webdriver.Chrome(service=service, options=options)
```

## Testing Best Practices

### 1. Use Test Data from test_data/

The `test_data/simple_checkout.html` file contains:
- Discount code input field
- Apply button
- Cart display
- All necessary form elements

### 2. Start Local Test Server

```bash
# Terminal 1: Start HTTP server
cd test_data
python3 -m http.server 8080

# Terminal 2: Run test
cd /home/user/oceanai-assignment
python data/scripts/test_script.py
```

### 3. Review Script Before Running

Always review generated scripts for:
- Correct URLs
- Appropriate wait times
- Valid selectors
- Expected assertions

### 4. Add Error Handling

Enhance generated scripts with try-catch blocks:

```python
try:
    # Test steps here
    driver.find_element(By.ID, "discount-code")
except Exception as e:
    print(f"Test failed: {e}")
    driver.save_screenshot("error_screenshot.png")
finally:
    driver.quit()
```

## Running Tests in CI/CD

### GitHub Actions Example

```yaml
name: Selenium Tests

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        pip install selenium webdriver-manager

    - name: Run Selenium tests
      run: |
        python data/scripts/TC_001_selenium.py
```

## Debugging Tips

### 1. Enable Verbose Logging

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 2. Take Screenshots

```python
driver.save_screenshot("debug_screenshot.png")
```

### 3. Print Page Source

```python
print(driver.page_source)
```

### 4. Use Browser DevTools

Run without headless mode to see the browser:
- Watch the automation happen in real-time
- Inspect elements during test execution
- Check console for JavaScript errors

## Example Test Run

```bash
# 1. Start the backend API
cd /home/user/oceanai-assignment
source venv/bin/activate
uvicorn backend.app.main:app --reload --port 8000

# 2. Start test HTML server (new terminal)
cd /home/user/oceanai-assignment/test_data
python3 -m http.server 8080

# 3. Generate and run test (new terminal)
cd /home/user/oceanai-assignment
source venv/bin/activate

# Use the UI to generate a script, then:
python data/scripts/TC_001_selenium.py

# Or use the test runner:
./run_selenium_test.sh data/scripts/TC_001_selenium.py
```

## Next Steps

1. **Generate test cases** for your features
2. **Generate Selenium scripts** from test cases
3. **Review and customize** scripts for your environment
4. **Run tests** locally
5. **Integrate** into CI/CD pipeline
6. **Monitor** test results and iterate

## Additional Resources

- [Selenium Documentation](https://www.selenium.dev/documentation/)
- [WebDriver Manager](https://github.com/SergeyPirogov/webdriver_manager)
- [Selenium Python Bindings](https://selenium-python.readthedocs.io/)
